plugins {
    id 'java'
    id 'antlr'
}

group = "cn.edu.bit.cs"
version = "1.0-SNAPSHOT"

repositories {
    mavenCentral()
}

generateGrammarSource {
    arguments += ["-visitor", "-long-messages"]
}

task testGrammar(type: Exec, dependsOn: classes) {
    workingDir './scripts'

    commandLine 'make', 'test'

    standardOutput = new ByteArrayOutputStream()
    errorOutput = new ByteArrayOutputStream()

    doLast {

        if (!errorOutput.toString().isEmpty()) {
            logger.error(errorOutput.toString())
            throw new GradleException(name + " have some error!")
        }
    }
}


dependencies {
    testCompileOnly "junit:junit:4.12"
    compileOnly "com.google.code.gson:gson:2.8.6"
    antlr "org.antlr:antlr4:4.8"
}

java {
    sourceCompatibility = JavaVersion.VERSION_1_8
}
